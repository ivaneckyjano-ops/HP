{% extends 'base.html' %}

{% block content %}
  <section class="dashboard">
    <header>
      <h1>Dashboard</h1>
    </header>
    <div class="widgets">
      <div class="widget">
        <h3>Rýchly prehľad</h3>
        <p>Celkový P/L dnes: <strong>+123€</strong></p>
        <p>Equity curve (mini)</p>
      </div>
      <div class="widget">
        <h3>Boty</h3>
        <table class="bots">
          <thead><tr><th>Názov</th><th>Stratégia</th><th>Trh</th><th>Kapitál</th><th>P/L</th><th>Status</th></tr></thead>
          <tbody>
            {% for b in bots %}
            <tr>
              <td>{{ b.name }}</td>
              <td>{{ b.strategy }}</td>
              <td>{{ b.market }}</td>
              <td>{{ b.capital }}</td>
              <td>{{ b.pl }}</td>
              <td>{{ b.status }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="widget">
        <h3>Stav testovania systému</h3>
        <ul>
          <li>Stratégie: {{ testing_status.strategies_count }} ({{ testing_status.strategies|join(', ') }})</li>
          <li>Watchlist: {{ testing_status.watchlist_count }} instrumentov</li>
          <li>Posledné vyhodnotenie: {{ testing_status.last_evaluation or 'Žiadne' }}</li>
          <li>Celkové obchody: {{ testing_status.total_trades }}</li>
          <li>Celkový P&L: <strong>${{ "%.2f"|format(testing_status.total_pnl) }}</strong></li>
        </ul>
        {% if testing_status.error %}
        <p style="color: red;">Chyba: {{ testing_status.error }}</p>
        {% endif %}
      </div>
      <div class="widget">
        <h3>Token služby</h3>
        <div class="token">
          <h4>Demo</h4>
          {% if token_demo %}
            <p>access_token: {{ token_demo.access_token[:8] }}... </p>
            <p>expires_at: {{ token_demo.expires_at }}</p>
          {% else %}
            <p><em>nie dostupné</em></p>
          {% endif %}
        </div>
        <div class="token">
          <h4>Live</h4>
          {% if token_live %}
            <p>access_token: {{ token_live.access_token[:8] }}... </p>
            <p>expires_at: {{ token_live.expires_at }}</p>
          {% else %}
            <p><em>nie dostupné</em></p>
          {% endif %}
        </div>
      </div>
    </div>
  </section>
{% endblock %}
